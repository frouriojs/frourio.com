---
id: posting-formdata
title: Posting FormData
---

<br />

```ts title="server/api/user/_userId/index.ts"
export type Methods = {
  post: {
    reqFormat: FormData // required
    reqBody: { icon: Blob }
    status: 204 // optional
  }
}
```

```ts title="server/api/user/_userId/controller.ts"
import { defineController } from './$relay'
import { changeIcon } from '$/service/user'

export default defineController(() => ({
  post: async ({ params, body }) => {
    await changeIcon(params.userId, body.icon)

    return { status: 204 }
  }
}))
```

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

<Tabs
  defaultValue="fastify"
  values={[
    { label: 'fastify', value: 'fastify' },
    { label: 'express', value: 'express' },
  ]
}>
<TabItem value="fastify">

```ts title="server/service/user.ts"
import fs from 'fs'
import path from 'path'
import { Multipart } from 'fastify-multipart'

export const changeIcon = async (id: string, iconFile: Multipart) => {
  const iconName = `${Date.now()}${path.extname(iconFile.filename)}`

  await fs.promises.writeFile(
    path.resolve('public/icons', id, iconName),
    await iconFile.toBuffer()
  )
}
```

[fastify-multipart](https://github.com/fastify/fastify-multipart#usage)

```text title="server/prisma/schema.prisma"
import Fastify from 'fastify'
import server from './$server' // '$server.ts' is automatically generated by frourio

const fastify = Fastify()

server(fastify, { basePath: '/api/v1', multipart: { fileSize: 1024 ** 3 } })
fastify.listen(3000)
```

[Multipart options](https://github.com/mscdex/busboy#busboy-methods)

</TabItem>
<TabItem value="express">

```ts title="server/service/user.ts"
import fs from 'fs'
import path from 'path'
import { MulterFile } from '$/$server'

export const changeIcon = async (id: string, iconFile: MulterFile) => {
  const iconName = `${Date.now()}${path.extname(iconFile.originalname)}`

  await fs.promises.copyFile(iconFile.path, path.resolve('public/icons', id, iconName))
  await fs.promises.unlink(iconFile.path)
}
```

[MulterFile information](https://github.com/expressjs/multer#file-information)

Key | Description | Note
--- | --- | ---
`fieldname` | Field name specified in the form |
`originalname` | Name of the file on the user's computer |
`encoding` | Encoding type of the file |
`mimetype` | Mime type of the file |
`size` | Size of the file in bytes |
`destination` | The folder to which the file has been saved | `DiskStorage`
`filename` | The name of the file within the `destination` | `DiskStorage`
`path` | The full path to the uploaded file | `DiskStorage`
`buffer` | A `Buffer` of the entire file | `MemoryStorage`

<br />

```ts title="server/index.ts"
import express from 'express'
import server from './$server' // '$server.ts' is automatically generated by frourio

const app = express()

server(app, { basePath: '/api/v1', multer: { limits: { fileSize: 1024 ** 3 } } })
app.listen(3000)
```

[Multer options](https://github.com/expressjs/multer#multeropts)

Key | Description | Default
--- | --- | ---
`dest` or `storage` | Where to store the files | path.join(__dirname, '.upload')
`fileFilter` | Function to control which files are accepted |
`limits` | Limits of the uploaded data | { fileSize: 1024 ** 3 }
`preservePath` | Keep the full path of files instead of just the base name |

</TabItem>
</Tabs>

<Tabs
  defaultValue="next"
  values={[
    { label: 'Next.js', value: 'next' },
    { label: 'Nuxt.js', value: 'nuxt' },
  ]
}>
<TabItem value="next">

Use [aspida](https://github.com/aspida/aspida) for the frontend HTTP client.  
(Frourio and aspida are maintained by the same developer)

```tsx title="components/UserBanner.tsx"
import { useCallback, ChangeEvent } from 'react'
import { apiClient } from '~/utils/apiClient'

const UserBanner = () => {
  const editIcon = useCallback(
    async (e: ChangeEvent<HTMLInputElement>) => {
      if (!e.target.files?.length) return

      await apiClient.user._userId(1).$post({
        body: { icon: e.target.files[0] }
      })
    },
    []
  )

  return <input type="file" accept="image/*" onChange={editIcon} />
}

export default UserBanner
```

</TabItem>
<TabItem value="nuxt">

Use [aspida](https://github.com/aspida/aspida) for the frontend HTTP client.  
(Frourio and aspida are maintained by the same developer)

```ts title="components/UserBanner.vue"
import Vue from 'vue'

export default Vue.extend({
  methods: {
    async editIcon(e: { target: HTMLInputElement }) {
      if (!e.target?.files?.length) return

      await this.$api.user._userId(1).$post({
        body: { icon: e.target.files[0] }
      })
    },
  }
})
```

</TabItem>
</Tabs>
