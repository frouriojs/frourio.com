---
id: entrypoint
title: Entrypoint of server
---

<br />

import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';

<Tabs
  defaultValue="fastify"
  values={[
    { label: 'fastify', value: 'fastify' },
    { label: 'express', value: 'express' },
  ]
}>
<TabItem value="fastify">

```ts title="server/service/app.ts"
import path from 'path'
import Fastify, { FastifyServerFactory } from 'fastify'
import helmet from 'fastify-helmet'
import cors from 'fastify-cors'
import fastifyStatic from 'fastify-static'
import fastifyJwt from 'fastify-jwt'
import {
  API_JWT_SECRET,
  API_BASE_PATH,
  API_UPLOAD_DIR
} from '$/service/envValues'
import server from '$/$server'

export const init = (serverFactory?: FastifyServerFactory) => {
  const app = Fastify({ serverFactory })
  app.register(helmet)
  app.register(cors)
  app.register(fastifyStatic, {
    root: path.join(__dirname, 'static'),
    prefix: '/static/'
  })
  if (API_UPLOAD_DIR) {
    app.after(() => {
      app.register(fastifyStatic, {
        root: path.resolve(__dirname, API_UPLOAD_DIR),
        prefix: '/upload/',
        decorateReply: false
      })
    })
  }
  app.register(fastifyJwt, { secret: API_JWT_SECRET })
  server(app, { basePath: API_BASE_PATH })
  return app
}
```

```ts title="server/entrypoints/index.ts"
import { init } from '$/service/app'
import { API_SERVER_PORT } from '$/service/envValues'

init().listen(API_SERVER_PORT, '0.0.0.0')
```

</TabItem>
<TabItem value="express">

```ts title="server/entrypoints/index.ts"
import express from 'express'
import helmet from 'helmet'
import cors from 'cors'
import server from '$/$server'
import {
  API_SERVER_PORT,
  API_BASE_PATH,
  API_UPLOAD_DIR
} from '$/service/envValues'

const app = express()
app.use(helmet())
app.use(cors())
server(app, { basePath: API_BASE_PATH })
app.use('/static', express.static('static'))
if (API_UPLOAD_DIR) app.use('/upload', express.static(API_UPLOAD_DIR))
app.listen(API_SERVER_PORT)

```

</TabItem>
</Tabs>
